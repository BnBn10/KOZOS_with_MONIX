/*****************************************************************************
	オーダー	: KOZOS エントリポイント
	CPU			: H8 3069F
	コンパイラ	: h8300-elf-gcc version 3.4.6
	ファイル名	: main.c
				: 
	作成日時	: 2013-10-25
*****************************************************************************/
/*
	改訂履歴
*/

/*****************************************************************************
	インクルード
*****************************************************************************/
#include	"defines.h"
#include	"kozos.h"
#include	"interrupt.h"
#include	"lib.h"
#ifdef _DRAM_ENABLE_
#include	"dram.h"
#endif	/* _DRAM_ENABLE_ */
/*****************************************************************************
	定義
*****************************************************************************/

/*****************************************************************************
	型定義、構造体定義
*****************************************************************************/

/*****************************************************************************
	外部変数
*****************************************************************************/
KZ_ID_T	test09_1_id;
KZ_ID_T	test09_2_id;
KZ_ID_T	test09_3_id;

/*****************************************************************************
	内部変数
*****************************************************************************/
char**	ppcOsEntryFp;

/*****************************************************************************
	プロトタイプ宣言
*****************************************************************************/
static int startThreads(int argc, char** argv);

/*****************************************************************************
	DISCRIPTION	: エントリーポイント
	ARGUMENT	: -
	RETURN		: 0		= 正常終了
				: 0以外	= 異常終了
	NOTE		: -
	UPDATED		: 2013-10-25
*****************************************************************************/
int main(int argc, char** argv)
{
	ppcOsEntryFp = argv;

	INTR_DISABLE();	/* 割り込み無効化 */
	puts((uint08*)"kozos boot succeed!\n");

//	usb_main();
	kzStart(startThreads, "idle", 0, 0x100, 0, NULL);
	/* ここには戻ってこない */
	
	return 0;
}

/*****************************************************************************
	DISCRIPTION	: システムタスクとユーザスレッドの起動
	ARGUMENT	: argc
				  argv
	RETURN		: 0		= 正常終了
				: 0以外	= 異常終了
	NOTE		: -
	UPDATED		: 2013-10-25
*****************************************************************************/
static int startThreads(int argc, char** argv)
{
	DPUTS((uint08*)"startThreads\n");

	kzRun(consdrv_main, "consdrv", 1, 0x200, 0, NULL);
	kzRun(command_main, "command", 8, 0x4000, 0, NULL);

	kzChgPri(15);
	INTR_ENABLE();
	while(1){
		asm volatile("sleep");
	}
	
	return 0;
}

/***** End Of File *****/


